<div class="task-card @GetPriorityClass()" @onclick="OnClick">
    <div class="task-card-header">
        <div class="task-title-section">
            <h5 class="task-title">@Task.Title</h5>
            @if (!string.IsNullOrEmpty(Task.CategoryName))
            {
                <span class="badge bg-secondary category-badge">@Task.CategoryName</span>
            }
        </div>
        <div class="task-actions">
            <button class="btn btn-sm btn-outline-primary" @onclick="@OnEdit" @onclick:stopPropagation="true">
                <i class="bi bi-pencil"></i>
            </button>
            <button class="btn btn-sm btn-outline-danger" @onclick="@OnDelete" @onclick:stopPropagation="true">
                <i class="bi bi-trash"></i>
            </button>
        </div>
    </div>

    @if (!string.IsNullOrEmpty(Task.Description))
    {
        <p class="task-description">@Task.Description</p>
    }

    <div class="task-footer">
        <div class="task-meta">
            <span class="badge @GetStatusBadgeClass()">@Task.Status</span>
            <span class="badge @GetPriorityBadgeClass()">@Task.Priority</span>
        </div>

        @if (Task.DueDate.HasValue)
        {
            <div class="task-due-date @(Task.IsOverdue ? "overdue" : "")">
                <i class="bi bi-calendar"></i>
                @Task.DueDate.Value.ToString("MMM dd, yyyy")
                @if (Task.IsOverdue)
                {
                    <span class="ms-1">(Overdue)</span>
                }
            </div>
        }
    </div>
</div>

@code {
    [Parameter]
    public TaskDto Task { get; set; } = default!;

    [Parameter]
    public EventCallback<TaskDto> OnTaskClick { get; set; }

    [Parameter]
    public EventCallback<TaskDto> OnEditTask { get; set; }

    [Parameter]
    public EventCallback<TaskDto> OnDeleteTask { get; set; }

    private async Task OnClick()
    {
        await OnTaskClick.InvokeAsync(Task);
    }

    private async Task OnEdit()
    {
        await OnEditTask.InvokeAsync(Task);
    }

    private async Task OnDelete()
    {
        await OnDeleteTask.InvokeAsync(Task);
    }

    private string GetPriorityClass()
    {
        return Task.Priority switch
        {
            TaskPriority.High => "priority-high",
            TaskPriority.Medium => "priority-medium",
            TaskPriority.Low => "priority-low",
            _ => ""
        };
    }

    private string GetStatusBadgeClass()
    {
        return Task.Status switch
        {
            Domain.Enums.TaskStatus.Completed => "bg-success",
            Domain.Enums.TaskStatus.InProgress => "bg-info",
            Domain.Enums.TaskStatus.Pending => "bg-warning",
            _ => "bg-secondary"
        };
    }

    private string GetPriorityBadgeClass()
    {
        return Task.Priority switch
        {
            TaskPriority.High => "bg-danger",
            TaskPriority.Medium => "bg-warning",
            TaskPriority.Low => "bg-info",
            _ => "bg-secondary"
        };
    }
}
