@page "/settings"
@attribute [Authorize]

<PageTitle>Settings - Task Scheduler</PageTitle>

<div class="container mt-4">
    <div class="row">
        <div class="col-lg-8 mx-auto">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3 class="mb-0">Notification Settings</h3>
                </div>
                <div class="card-body">
                    <p class="text-muted mb-4">
                        Configure how you want to receive notifications about your tasks and reminders.
                    </p>

                    <EditForm Model="@settings" OnValidSubmit="@SaveSettings">
                        <div class="mb-4">
                            <h5 class="border-bottom pb-2">Email Notifications</h5>

                            <div class="form-check mb-3">
                                <InputCheckbox id="emailReminders" class="form-check-input"
                                    @bind-Value="settings.EmailReminders" />
                                <label class="form-check-label" for="emailReminders">
                                    <strong>Task Reminders</strong><br />
                                    <small class="text-muted">Receive emails when task reminders are due</small>
                                </label>
                            </div>

                            <div class="form-check mb-3">
                                <InputCheckbox id="emailDailyDigest" class="form-check-input"
                                    @bind-Value="settings.EmailDailyDigest" />
                                <label class="form-check-label" for="emailDailyDigest">
                                    <strong>Daily Digest</strong><br />
                                    <small class="text-muted">Get a daily summary of your pending tasks</small>
                                </label>
                            </div>

                            <div class="form-check mb-3">
                                <InputCheckbox id="emailWeeklySummary" class="form-check-input"
                                    @bind-Value="settings.EmailWeeklySummary" />
                                <label class="form-check-label" for="emailWeeklySummary">
                                    <strong>Weekly Summary</strong><br />
                                    <small class="text-muted">Receive a weekly overview of completed and pending
                                        tasks</small>
                                </label>
                            </div>
                        </div>

                        <div class="mb-4">
                            <h5 class="border-bottom pb-2">Push Notifications</h5>

                            <div class="form-check mb-3">
                                <InputCheckbox id="pushReminders" class="form-check-input"
                                    @bind-Value="settings.PushNotifications" />
                                <label class="form-check-label" for="pushReminders">
                                    <strong>Browser Push Notifications</strong><br />
                                    <small class="text-muted">Show browser notifications for task reminders</small>
                                </label>
                            </div>
                        </div>

                        <button type="submit" class="btn btn-primary" disabled="@isSaving">
                            @if (isSaving)
                            {
                                <span class="spinner-border spinner-border-sm me-2" role="status"></span>
                                <span>Saving...</span>
                            }
                            else
                            {
                                <span>Save Settings</span>
                            }
                        </button>
                    </EditForm>

                    @if (!string.IsNullOrEmpty(successMessage))
                    {
                        <div class="alert alert-success mt-3" role="alert">
                            @successMessage
                        </div>
                    }
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    private NotificationSettingsModel settings = new();
    private bool isSaving;
    private string? successMessage;

    protected override async Task OnInitializedAsync()
    {
        await LoadSettings();
    }

    private async Task LoadSettings()
    {
        // TODO: Load from API when endpoint is available
        await Task.CompletedTask;

        // Default settings for now
        settings = new NotificationSettingsModel
        {
            EmailReminders = true,
            EmailDailyDigest = true,
            EmailWeeklySummary = false,
            PushNotifications = true
        };
    }

    private async Task SaveSettings()
    {
        try
        {
            isSaving = true;
            successMessage = null;

            // TODO: Save to API when endpoint is available
            await Task.Delay(500); // Simulate API call

            successMessage = "Settings saved successfully!";
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error saving settings: {ex.Message}");
        }
        finally
        {
            isSaving = false;
        }
    }

    public class NotificationSettingsModel
    {
        public bool EmailReminders { get; set; }
        public bool EmailDailyDigest { get; set; }
        public bool EmailWeeklySummary { get; set; }
        public bool PushNotifications { get; set; }
    }
}